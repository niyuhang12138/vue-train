{
  "version": 3,
  "sources": ["../src/nodeOps.ts", "../src/modules/attr.ts", "../src/modules/class.ts", "../src/modules/event.ts", "../src/modules/style.ts", "../src/patchProps.ts", "../../shared/src/index.ts", "../../runtime-core/src/vnode.ts", "../../runtime-core/src/h.ts", "../../runtime-core/src/renderer.ts", "../src/index.ts"],
  "sourcesContent": ["// \u5143\u7D20\u7684\u589E\u5220\u6539\u67E5\uFF0C\u67E5\u627E\u5173\u7CFB\uFF0C \u6587\u672C\u7684\u589E\u5220\u6539\u67E5\n\nexport const nodeOps = {\n    createElement(tagName: string): HTMLElement {\n        // \u8FD9\u91CC\u7684tagName\u662F\u5C0F\u5199\u7684\n        const el = document.createElement(tagName);\n        return el;\n    },\n    // \u79FB\u52A8\u6027\u7684\u64CD\u4F5C\n    // A B C D -> A C D B\n    insert: (\n        child: HTMLElement,\n        parent: HTMLElement,\n        anchor?: HTMLElement | null\n    ) => {\n        parent.insertBefore(child, anchor || null); // anchor\u4E3Anull\u65F6\uFF0C\u8868\u793A\u5728parent\u7684\u6700\u540E\u63D2\u5165child\n    },\n    remove(child: HTMLElement) {\n        const parent = child.parentNode;\n        if (parent) {\n            parent.removeChild(child);\n        }\n    },\n    querySelector(selector: string): HTMLElement | null {\n        return document.querySelector(selector);\n    },\n    parentNode(node: Node): Node | null {\n        return node.parentNode;\n    },\n    nextSibling(node: Node): Node | null {\n        return node.nextSibling;\n    },\n    setElementText(el: HTMLElement, text: string) {\n        el.textContent = text;\n    },\n    createText(text: string): Text {\n        return document.createTextNode(text);\n    },\n    setText(node: Text, text: string) {\n        node.nodeValue = text;\n    },\n};\n", "export const patchAttr = (el: HTMLElement, key: string, value: string) => {\n    if (value === null) {\n        // \u5982\u679C\u6CA1\u6709\u503C\u4E86\uFF0C\u5220\u9664\u5C5E\u6027\n        el.removeAttribute(key);\n    } else {\n        // \u5982\u679C\u6709\u503C\u4E86\uFF0C\u8BBE\u7F6E\u5C5E\u6027\n        el.setAttribute(key, value);\n    }\n};\n", "export const patchClass = (el: Element, value: string | null) => {\n    if (value === null) {\n        // \u5982\u679C\u6CA1\u6709\u7C7B\u578B \u5C31\u79FB\u9664\n        el.removeAttribute(\"class\");\n    } else {\n        el.setAttribute(\"class\", value);\n    }\n};\n", "// Extend HTMLElement to include _vei and _vit\ninterface HTMLElement {\n    removeEventListener(event_name: string, existingInvoker: any): unknown;\n    addEventListener(\n        event_name: string,\n        invoker: { (e: Event): any; value: any }\n    ): unknown;\n    _vei?: any;\n    _vit?: any;\n}\n\nfunction createInvoker(initialValue) {\n    const invoker = (e) => invoker.value(e);\n    invoker.value = initialValue;\n    return invoker;\n}\n\nexport const patchEvent = (\n    el: HTMLElement,\n    key: string,\n    prevValue,\n    nextValue\n) => {\n    // vue event invoker\n    const invokers = el._vei || (el._vit = {});\n    const event_name = key.slice(2).toLowerCase(); // onClick -> click\n    const existingInvoker = invokers[event_name];\n\n    if (nextValue && existingInvoker) {\n        existingInvoker.value = nextValue;\n    } else {\n        if (nextValue) {\n            // \u5982\u679C\u6709\u65B0\u7684\u503C\n            const invoker = (invokers[event_name] = createInvoker(nextValue));\n            el.addEventListener(event_name, invoker);\n        } else {\n            // \u5982\u679CnextValue\u4E0D\u5B58\u5728\uFF0C\u8BF4\u660E\u662F\u5220\u9664\u4E8B\u4EF6\n            el.removeEventListener(event_name, existingInvoker);\n            invokers[event_name] = null;\n        }\n    }\n};\n", "export const patchStyle = (\n    el: HTMLElement,\n    prev: CSSStyleDeclaration | null,\n    next: CSSStyleDeclaration | null\n) => {\n    if (next) {\n        const style = el.style;\n\n        for (const key in next) {\n            style[key] = next[key];\n        }\n\n        for (const key in prev) {\n            if (next[key] == null) {\n                // \u5982\u679C\u65B0\u503C\u6CA1\u6709\u8FD9\u4E2A\u5C5E\u6027\n                style[key] = null; // \u5220\u9664\u8FD9\u4E2A\u5C5E\u6027\n            }\n        }\n    } else {\n        el.removeAttribute(\"style\");\n    }\n};\n", "import { patchAttr } from \"./modules/attr\";\nimport { patchClass } from \"./modules/class\";\nimport { patchEvent } from \"./modules/event\";\nimport { patchStyle } from \"./modules/style\";\n\nexport const patchProp = (\n    el: HTMLElement,\n    key: string,\n    prevValue,\n    nextValue\n) => {\n    // class / style / on / attr\n    if (key === \"class\") {\n        patchClass(el, nextValue);\n    } else if (key === \"style\") {\n        patchStyle(el, prevValue, nextValue);\n    } else if (/^on[^a-z]/.test(key)) {\n        // \u4E8B\u4EF6\u7684\u5904\u7406\n        patchEvent(el, key, prevValue, nextValue);\n    } else {\n        // attr\n        patchAttr(el, key, nextValue);\n    }\n};\n", "export * from \"./shapeFlags\";\n\nexport function isObject(value: unknown): boolean {\n    return typeof value === \"object\" && value !== null;\n}\n\nexport function isFunction(value: unknown): boolean {\n    return typeof value === \"function\";\n}\n\nexport function isString(value: unknown): boolean {\n    return typeof value === \"string\";\n}\n", "import { isString, ShapeFlags } from \"@vue/shared\";\n\nexport interface VNode {\n    __v_isVNode: boolean; // \u6807\u8BC6\u662F\u865A\u62DF\u8282\u70B9\n    type: string; // \u8282\u70B9\u7C7B\u578B\n    props: Record<string, any> | null; // \u8282\u70B9\u5C5E\u6027\n    children: any; // \u5B50\u8282\u70B9\n    shapeFlag: number; // \u8282\u70B9\u7C7B\u578B\u6807\u8BC6\n    key: string | number | null; // \u552F\u4E00\u6807\u8BC6\n    el: any; // \u771F\u5B9E\u8282\u70B9\n}\n\nexport function isVNode(value: any): boolean {\n    return !!(value && value.__v_isVNode);\n}\n\nexport function isSameVNode(n1: VNode, n2: VNode): boolean {\n    return n1.type === n2.type && n1.key === n2.key;\n}\n\nexport function createVNode(\n    type: string,\n    props = null,\n    children = null\n): VNode {\n    // \u7EC4\u4EF6\n    // \u5143\u7D20\n    // \u6587\u672C\n    // \u81EA\u5B9A\u4E49\u7684keep-alive\n\n    // \u7528\u6807\u8BC6\u6765\u533A\u5206 \u5BF9\u5E94\u7684\u865A\u62DF\u8282\u70B9\u7C7B\u578B\uFF0C \u8FD9\u4E2A\u8868\u793A\u91C7\u7528\u7684\u662F\u4F4D\u8FD0\u7B97\u7684\u65B9\u5F0F \u53EF\u4EE5\u65B9\u4FBF\u7EC4\u5408\n    const shapeFlag = isString(type) ? ShapeFlags.ELEMENT : 0;\n\n    // \u865A\u62DF\u8282\u70B9\u8981\u5BF9\u5E94\u771F\u5B9E\u8282\u70B9\n    const vnode: VNode = {\n        __v_isVNode: true, // \u6807\u8BC6\u662F\u865A\u62DF\u8282\u70B9\n        type,\n        props,\n        children,\n        shapeFlag, // \u8282\u70B9\u7C7B\u578B\n        key: props?.key,\n        el: null, // \u771F\u5B9E\u8282\u70B9\n    };\n\n    if (children) {\n        let type = 0;\n        if (Array.isArray(children)) {\n            type = ShapeFlags.ARRAY_CHILDREN; // \u6570\u7EC4\n        } else {\n            type = ShapeFlags.TEXT_CHILDREN; // \u6587\u672C\n        }\n        vnode.shapeFlag |= type;\n    }\n\n    return vnode;\n}\n", "import { isObject } from \"@vue/shared\";\nimport { createVNode, isVNode } from \"./vnode\";\n\n// \u63D0\u4F9B\u591A\u6837\u7684api\uFF0C \u6839\u636E\u53C2\u6570\u533A\u5206\nexport function h(type, propsOrChildren?, children?) {\n    const l = arguments.length;\n\n    // h(type, {}) h(type, h('span')) / h(type, 'text) h(type, [])\n    if (l === 2) {\n        if (isObject(propsOrChildren) && !Array.isArray(propsOrChildren)) {\n            if (isVNode(propsOrChildren)) {\n                return createVNode(type, null, [propsOrChildren]);\n            }\n            return createVNode(type, propsOrChildren);\n        } else {\n            return createVNode(type, null, propsOrChildren);\n        }\n    } else {\n        if (l > 3) {\n            // h('div', {}, 'a', 'b')  \u8FD9\u6837\u64CD\u4F5C\u7684\u7B2C\u4E8C\u4E2A\u53C2\u6570\u5FC5\u987B\u662F\u5C5E\u6027\n            children = Array.from(arguments).slice(2);\n        } else if (l === 3 && isVNode(children)) {\n            // h('div', {}, h('span'))  \u8FD9\u6837\u64CD\u4F5C\u7684\u7B2C\u4E8C\u4E2A\u53C2\u6570\u5FC5\u987B\u662F\u5C5E\u6027\n            children = [children];\n        }\n\n        return createVNode(type, propsOrChildren, children);\n    }\n}\n", "import { ShapeFlags } from \"@vue/shared\";\nimport { isSameVNode, type VNode } from \"./vnode\";\n\ninterface RendererOptions {\n    createElement: Function;\n    insert: Function;\n    remove: Function;\n    patchProp: Function;\n    querySelector: Function;\n    parentNode: Function;\n    nextSibling: Function;\n    setElementText: Function;\n    createText: Function;\n    setText: Function;\n}\n\ninterface HTMLElement {\n    _vnode: VNode | null; // \u8BB0\u5F55\u5F53\u524D\u7684\u865A\u62DF\u8282\u70B9\n}\n\n// createRanderer\u7684\u4F5C\u7528\u662F\u81EA\u5B9A\u4E49\u6E32\u67D3\u65B9\u5F0F\nexport function createRenderer(options: RendererOptions) {\n    const {\n        createElement: hostCreateElement,\n        insert: hostInsert,\n        remove: hostRemove,\n        patchProp: hostPatchProp,\n        querySelector: hostQuerySelector,\n        parentNode: hostParentNode,\n        nextSibling: hostNextSibling,\n        setElementText: hostSetElementText,\n        createText: hostCreateText,\n        setText: hostSetText,\n    } = options;\n\n    const mountChildren = (children: any[], el) => {\n        children.forEach((child: VNode) => {\n            patch(null, child, el);\n        });\n    };\n\n    const unmountChildren = (children: any[]) => {\n        children.forEach((child) => {\n            unmount(child);\n        });\n    };\n\n    const mountElement = (vnode: VNode, container, anchor = null) => {\n        const { type, props, children, shapeFlag } = vnode;\n\n        const el = (vnode.el = hostCreateElement(type));\n\n        if (props) {\n            for (const key in props) {\n                hostPatchProp(el, key, null, props[key]);\n            }\n        }\n\n        // 1 | 1 << 4\n        //  00001\n        //  10000\n        //  10001\n        // 10001 & 1 << 4\n        //  10001\n        //  10000\n        //  10000\n        if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {\n            mountChildren(children, el);\n        }\n        // 1 | 1 << 5\n        //  000001\n        //  100000\n        //  100001\n        // 100001 & 1 << 5\n        //  100001\n        //  100000\n        //  100000\n        else if (shapeFlag & ShapeFlags.TEXT_CHILDREN) {\n            hostSetElementText(el, children);\n        }\n        hostInsert(el, container, anchor); // \u63D2\u5165\u8282\u70B9\n    };\n\n    const patchProps = (oldProps, newProps, el) => {\n        if (oldProps !== newProps) {\n            for (const key in newProps) {\n                const prev = oldProps[key];\n                const next = newProps[key];\n                if (prev !== next) {\n                    // \u66F4\u65B0\u5C5E\u6027\n                    hostPatchProp(el, key, prev, next);\n                }\n            }\n\n            // \u5220\u9664\u65E7\u7684\u5C5E\u6027\n            for (const key in oldProps) {\n                if (!(key in newProps)) {\n                    hostPatchProp(el, key, oldProps[key], null);\n                }\n            }\n        }\n    };\n\n    const patchKeyedChildren = (c1: Array<VNode>, c2: Array<VNode>, el) => {\n        // \u5168\u91CFdiff\u7B97\u6CD5 \u5BF9\u6BD4\u8FC7\u7A0B\u662F\u6DF1\u5EA6\u904D\u5386 \u5148\u904D\u5386\u7236\u4EB2, \u5728\u904D\u5386\u5B69\u5B50 \u90FD\u8981\u5BF9\u6BD4\u4E00\u904D\n        // \u76EE\u524D\u6CA1\u6709\u4F18\u5316, \u6CA1\u6709\u5173\u5FC3, \u53EA\u5BF9\u6BD4\u53D8\u5316\u7684\u90E8\u5206 blockTree patchFlags\n        // \u540C\u7EA7\u5BF9\u6BD4 \u7236\u548C\u7236\u5BF9\u6BD4, \u5B50\u548C\u5B50\u5BF9\u6BD4 ... \u91C7\u7528\u7684\u662F\u6DF1\u5EA6\u904D\u5386\n\n        let i = 0; // \u9ED8\u8BA4\u4ECE0\u5F00\u59CB\u5BF9\u6BD4\n\n        let e1 = c1.length - 1; // \u65E7\u7684\u6700\u540E\u4E00\u4E2A\n        let e2 = c2.length - 1; // \u65B0\u7684\u6700\u540E\u4E00\u4E2A\n\n        // a b   e d\n        // a b c e d\n\n        // i = 0 / e1 = 3 / e2 = 4\n\n        while (i <= e1 && i <= e2) {\n            const n1 = c1[i];\n            const n2 = c2[i];\n\n            if (isSameVNode(n1, n2)) {\n                patch(n1, n2, el); // \u6DF1\u5EA6\u904D\u5386\n            } else {\n                break;\n            }\n\n            i++;\n        }\n\n        // i = 2 / e1 = 3 / e2 = 4\n\n        while (i <= e1 && i <= e2) {\n            const n1 = c1[e1];\n            const n2 = c2[e2];\n\n            if (isSameVNode(n1, n2)) {\n                patch(n1, n2, el); // \u6DF1\u5EA6\u904D\u5386\n            } else {\n                break;\n            }\n\n            e1--;\n            e2--;\n        }\n\n        // i = 2 / e1 = 1 / e2 = 2\n\n        // a b\n        // a b c\n        // i = 2 / e1 = 1 / e2 = 2\n\n        // \u6DFB\u52A0\u8FD8\u662F\u5220\u9664? i \u6BD4e1\u5927 \u8BF4\u660E\u65B0\u7684\u6BD4\u8001\u7684\u957F\n\n        // i > e1 \u65B0\u7684\u6BD4\u8001\u7684\u957F\n        // \u540C\u5E8F\u5217\u6302\u8F7D\n        if (i > e1) {\n            // \u65B0\u589E\n            if (i <= e2) {\n                // \u770B\u4E00\u4E0B \u5982\u679Ce2\u5F80\u524D\u79FB\u52A8\u4E86, \u90A3\u4E48e2\u7684\u4E0B\u4E00\u4E2A\u503C\u80AF\u5B9A\u5B58\u5728, \u5411\u524D\u63D2\u5165\n                // \u5982\u679Ce2\u6CA1\u6709\u52A8, \u90A3\u4E48e2\u7684\u4E0B\u4E00\u4E2A\u503C\u80AF\u5B9A\u4E0D\u5B58\u5728, \u4EE5\u4E3A\u8FD9\u5411\u540E\u63D2\u5165\n                const nextPos = e2 + 1;\n                const anchor = nextPos < c2.length ? c2[nextPos].el : null;\n                while (i <= e2) {\n                    patch(null, c2[i], el, anchor);\n                    i++;\n                }\n            }\n        }\n        // a b c d\n        // a b\n        // i = 2 / e1 = 3 / e2 = 1\n\n        // d c a b\n        //     a b\n        // i = 0 / e1 = 1 / e2 = -1\n\n        // i > e2 \u65E7\u7684\u6BD4\u65B0\u7684\u957F\n        else if (i > e2) {\n            // \u5220\u9664\n            while (i <= e1) {\n                unmount(c1[i]);\n                i++;\n            }\n        }\n\n        // old | a b c d e   f g\n        // new | a b e c d h f g\n        // i = 2 / e1 = 4 / e2 = 5\n\n        // c d e\n        // e c d h\n        else {\n            let s1 = i; // s1 -> e1\n            let s2 = i; // s2 -> e2\n            // \u8FD9\u91CC\u6211\u4EEC\u8981\u670D\u7528\u8001\u8282\u70B9? key\n            // vue2\u4E2D\u6839\u636E\u8001\u8282\u70B9\u521B\u5EFA\u7684\u6620\u5C04\u8868\n            // vue3\u4E2D\u6839\u636E\u65B0\u7684key\u521B\u5EFA\u7684\u6620\u5C04\u8868\n            const keyToIndexMap = new Map();\n            for (let i = s2; i <= e2; i++) {\n                const vnode = c2[i];\n                keyToIndexMap.set(vnode.key, i);\n            }\n\n            // \u6709\u4E86\u65B0\u7684\u6620\u5C04\u8868\u540E, \u53BB\u8001\u7684\u4E2D\u67E5\u627E\u4E00\u4E0B, \u770B\u4E00\u4E0B\u662F\u5426\u5B58\u5728, \u5982\u679C\u5B58\u5728\u9700\u8981\u670D\u7528\n\n            const toBePatched = e2 - s2 + 1; // \u65B0\u7684\u8282\u70B9\u6570\u91CF\n            const newIndexToOldMap = new Array(toBePatched).fill(0);\n            for (let i = s1; i <= e1; i++) {\n                const child = c1[i];\n\n                let newIndex = keyToIndexMap.get(child.key); // \u901A\u8FC7\u8001\u7684key\u6765\u67E5\u627E\u5BF9\u5E94\u65B0\u7684\u7D22\u5F15\n\n                if (newIndex === undefined) {\n                    unmount(child); // \u5220\u9664\n                } else {\n                    newIndexToOldMap[newIndex - s2] = i + 1;\n                    patch(child, c2[newIndex], el);\n                }\n            }\n            // \u6211\u4EEC\u5DF2\u7ECF\u670D\u7528\u4E86\u8282\u70B9, \u5E76\u4E14\u66F4\u65B0\u4E86\u670D\u7528\u8282\u70B9\u7684\u5C5E\u6027, \u5DEE\u79FB\u52A8\u64CD\u4F5C, \u548C\u65B0\u7684\u91CC\u9762\u6709\u8001\u7684\u91CC\u9762\u6CA1\u6709\u7684\u64CD\u4F5C\n\n            // \u5982\u4F55\u77E5\u9053\u65B0\u7684\u91CC\u9762\u6709\u7684\u8001\u7684\u91CC\u9762\u6CA1\u6709\n\n            console.log(newIndexToOldMap);\n            const seq = getSequence(newIndexToOldMap);\n            console.log(seq);\n\n            let j = seq.length - 1;\n            for (let i = toBePatched - 1; i >= 0; i--) {\n                const nextIndex = s2 + i;\n                const nextChild = c2[nextIndex];\n                let anchor =\n                    nextIndex + 1 < c2.length ? c2[nextIndex + 1].el : null;\n                // \u9ED8\u8BA4\u627E\u5230f \u628Ah \u63D2\u5165\u5230f\u7684\u524D\u9762\n                if (newIndexToOldMap[i] === 0) {\n                    // \u65B0\u589E\u7684\n                    // \u521B\u5EFA\u5143\u7D20\u5E76\u63D2\u5165\n                    patch(null, nextChild, el, anchor);\n                } else {\n                    // \u76F4\u63A5\u63D2\u5165\u5373\u53EF\n                    // \u5012\u53D9\u63D2\u5165\n                    // hostInsert(nextChild.el, el, anchor);\n                    // \u8FD9\u4E2A\u63D2\u5165\u64CD\u4F5C\u6BD4\u8F83\u66B4\u529B\uFF0C \u6574\u4E2A\u505A\u4E86\u79FB\u52A8\uFF0C \u4F46\u662F\u6211\u4EEC\u9700\u8981\u4F18\u5316\u79FB\u52A8\u7684\u64CD\u4F5C\n                    // [5, 3, 4, 0]\n                    // \u7D22\u5F15\u4E3A1,2\u7684\u4E0D\u7528\u52A8\n\n                    // \u4F18\u5316\n                    if (i !== seq[j]) {\n                        // \u8BF4\u660E\u9700\u8981\u79FB\u52A8\n                        hostInsert(nextChild.el, el, anchor);\n                    } else {\n                        j--; // \u8BF4\u660E\u4E0D\u9700\u8981\u79FB\u52A8\n                    }\n                }\n            }\n        }\n    };\n\n    const patchChildren = (n1: VNode, n2: VNode, el) => {\n        // \u5BF9\u6BD4\u5B50\u5DEE\u5F02\n        /**\n         * new          old         handle\n         * text         array       del old -> set text\n         * text         text        update text\n         * text         null        set text\n         * array        array       diff\n         * array        text        del old -> set array\n         * array        null        set array\n         * null         array       del old\n         * null         text        del old\n         * null         null        do nothing\n         */\n        const c1 = n1.children;\n        const c2 = n2.children;\n\n        const prevShapeFlag = n1.shapeFlag;\n        const shapeFlag = n2.shapeFlag;\n\n        // \u65B0\u7684\u662F\u6587\u672C\n        if (shapeFlag & ShapeFlags.TEXT_CHILDREN) {\n            // \u65E7\u7684\u662F\u6570\u7EC4\n            if (prevShapeFlag & ShapeFlags.ARRAY_CHILDREN) {\n                // \u5220\u9664\u65E7\u7684\n                unmountChildren(c1);\n            }\n            if (c1 !== c2) {\n                // \u8BBE\u7F6E\u65B0\u7684\u6587\u672C\n                hostSetElementText(el, c2);\n            }\n        } else {\n            // \u65E7\u7684\u662F\u6570\u7EC4\n            if (prevShapeFlag & ShapeFlags.ARRAY_CHILDREN) {\n                // \u65B0\u7684\u662F\u6570\u7EC4\n                if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {\n                    // diff\u7B97\u6CD5\n                    patchKeyedChildren(c1, c2, el);\n                } else {\n                    // \u8001\u7684\u662F\u6570\u7EC4\uFF0C\u65B0\u7684\u4E0D\u662F\u6570\u7EC4\uFF0C \u5220\u9664\u6570\u7EC4\n                    unmountChildren(c1);\n                    // \u8BBE\u7F6E\u65B0\u7684\u6587\u672C\n                    hostSetElementText(el, c2);\n                }\n            } else {\n                // \u65E7\u7684\u662F\u6587\u672C\n                if (prevShapeFlag & ShapeFlags.TEXT_CHILDREN) {\n                    hostSetElementText(el, \"\");\n                }\n                // \u65B0\u7684\u662F\u6570\u7EC4\n                if (shapeFlag & ShapeFlags.ARRAY_CHILDREN) {\n                    mountChildren(c2, el);\n                }\n            }\n        }\n    };\n\n    const patchElement = (n1: VNode, n2: VNode) => {\n        // \u5BF9\u6BD4n1\u548Cn2\u7684\u5C5E\u6027\u5DEE\u5F02\n        let el = (n2.el = n1.el); // \u590D\u7528\u65E7\u8282\u70B9\n        const oldProps = n1.props || {};\n        const newProps = n2.props || {};\n        patchProps(oldProps, newProps, el);\n\n        patchChildren(n1, n2, el);\n    };\n\n    const processElement = (\n        n1: VNode | null,\n        n2: VNode,\n        container,\n        anchor = null\n    ) => {\n        if (n1 === null) {\n            // \u521D\u6B21\u6E32\u67D3\n            mountElement(n2, container, anchor);\n        } else {\n            // diff\u7B97\u6CD5\n            patchElement(n1, n2);\n        }\n    };\n\n    const patch = (n1: VNode | null, n2: VNode, container, anchor = null) => {\n        if (n1 === n2) {\n            return; // \u65E0\u9700\u66F4\u65B0\n        }\n        // ni div -> n2 p\n\n        // \u5982\u679Cn1 n2\u90FD\u6709\u503C\uFF0C \u4F46\u662F\u7C7B\u578B\u4E0D\u540C\u5219\u5220\u9664n1 \u6362n2\n        if (n1 && !isSameVNode(n1, n2)) {\n            unmount(n1); // \u5220\u9664n1\n            n1 = null; // \u7F6E\u7A7A\n        }\n\n        processElement(n1, n2, container, anchor);\n    };\n\n    const unmount = (vnode: VNode) => hostRemove(vnode.el);\n\n    const render = (vnode: VNode, container) => {\n        if (vnode === null) {\n            // \u5378\u8F7D\uFF1A \u5220\u9664\u8282\u70B9\n            if (container._vnode) {\n                // \u6E32\u67D3\u8FC7 \u624D\u80FD\u5378\u8F7D\n                unmount(container._vnode);\n            }\n        } else {\n            // \u521D\u6B21\u6E32\u67D3 \u66F4\u65B0\n            patch(container._vnode || null, vnode, container);\n        }\n\n        container._vnode = vnode; // \u8BB0\u5F55\u5F53\u524D\u7684\u865A\u62DF\u8282\u70B9\n    };\n\n    return {\n        render,\n    };\n}\n\n// \u8D2A\u5FC3 + \u4E8C\u5206 + \u8FFD\u6EAF\nfunction getSequence(arr: Array<number>) {\n    let len = arr.length;\n    let result = [0];\n    let resultLastIndex: number;\n    let start: number;\n    let end: number;\n    let middle: number;\n\n    let p = arr.slice(0); // \u7528\u6765\u8868\u793A\u7D22\u5F15\u7684\n\n    for (let i = 0; i < len; i++) {\n        const arrI = arr[i];\n        // vue\u4E2D\u5E8F\u5217\u4E2D\u4E0D\u4F1A\u51FA\u73B00, \u5982\u679C\u5E8F\u5217\u4E2D\u51FA\u73B00\u7684\u8BDD\u53EF\u4EE5\u5FFD\u7565\n        if (arrI !== 0) {\n            resultLastIndex = result[result.length - 1];\n            if (arr[resultLastIndex] < arrI) {\n                result.push(i);\n                p[i] = resultLastIndex; // \u8BB0\u5F55\u524D\u9A71\u8282\u70B9\n                continue;\n            }\n\n            // \u8FD9\u91CC\u5C31\u4F1A\u51FA\u73B0\uFF0C \u5F53\u524D\u5411\u6BD4\u6700\u540E\u4E00\u9879\u5927\n            start = 0;\n            end = result.length - 1;\n\n            while (start < end) {\n                middle = ((start + end) / 2) | 0;\n\n                if (arr[result[middle]] < arrI) {\n                    start = middle + 1;\n                } else {\n                    end = middle;\n                }\n            }\n\n            // middle \u5C31\u662F\u7B2C\u4E00\u4E2A\u6BD4\u5F53\u524D\u503C\u5927\u7684\u503C\n            if (arrI < arr[result[start]]) {\n                p[i] = result[start - 1]; // \u8BB0\u5F55\u524D\u9A71\u8282\u70B9\n                result[start] = i;\n            }\n        }\n    }\n\n    // \u8FFD\u6EAF\n    let i = result.length;\n    let last = result[i - 1];\n\n    while (i-- > 0) {\n        result[i] = arr[last];\n        last = p[last];\n    }\n\n    return result;\n}\n", "// \u5BF9\u5143\u7D20\u53EF\u4EE5\u8FDB\u884C\u8282\u70B9\u64CD\u4F5C\nimport { nodeOps } from \"./nodeOps\";\nimport { patchProp } from \"./patchProps\";\nimport { createRenderer } from \"@vue/runtime-core\";\n\nexport const renderOptions = Object.assign(nodeOps, { patchProp });\n\nexport const render = (vnode, container) => {\n    return createRenderer(renderOptions).render(vnode, container);\n};\n\nexport * from \"@vue/runtime-core\";\n"],
  "mappings": "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",
  "names": ["type", "i", "render"]
}
